{% import "form.twig" as forms %}
{{ forms.select('purchasingAccount', 'Purchasing account'|trans, purchaisingAccountsList, providerInvoiceAmount.purchasingAccount.id, 'id', 'label') }}
<div class="row-fluid">
	<div class="span4 offset4">
	{{ forms.input('amountTi', 'Amount taxes included'|trans, providerInvoiceAmount.amountTi) }}
	</div>
</div>
<div class="row-fluid">
	<div class="span4">
	{{ forms.input('amountDf', 'Amount without taxes'|trans, providerInvoiceAmount.amountDf) }}
	</div>
	<div class="span2 offset1">
		<strong>{% trans %}Or{% endtrans %}</strong>
	</div>
	<div class="span4">
	{{ forms.input('taxes', 'Taxes'|trans, providerInvoiceAmount.taxes) }}
	</div>
</div>

<script>
    $("#provider-invoice-edit-amount-modal form").attr("action", '{{ url('commercial_provider_invoices_edit_amount', {Id : providerInvoiceAmount.id }) }}');
    $(function() {
       $("#provider-invoice-edit-amount-modal form").submit(function(e) {
           e.preventDefault();
       }).validate({
            ignore: "input[type='text']:hidden",
            rules:{
                purchasingAccount:{
                        required:true
                },
                amountTi:{
                        required:true
                },
                taxes: {
                    required: {
                        depends:function() {
                            return !$('#id-amountDf').val();
                        }
                    }
                    
                },
                amountDf: {
                    required: {
                        depends:function() {
                            return !$('#id-taxes').val();
                        }
                    }                    
                }
            },
            errorClass: "help-inline",
            errorElement: "span",
            errorPlacement: function(error, element) {
                    element.parent().after(error);
            },
            highlight:function(element, errorClass, validClass) {
                    $(element).parents('.control-group').removeClass('success');
                    $(element).parents('.control-group').addClass('error');
            },
            unhighlight: function(element, errorClass, validClass) {
                    $(element).parents('.control-group').removeClass('error');
                    $(element).parents('.control-group').addClass('success');
            },
            submitHandler: function(form) {
                if($('#id-taxes').val() && $('#id-amountDf').val()) {
                    if(parseFloat($('#id-amountTi').val()).toFixed(2) !== parseFloat(parseFloat($('#id-amountDf').val()) + parseFloat($('#id-taxes').val())).toFixed(2)) {
                        var errors = {
                            taxes: '{{ "Set only one of the two fields"|trans|e('js') }}',
                            amountDf: '{{ "Set only one of the two fields"|trans|e('js') }}'    
                        };
                        this.showErrors(errors);
                        return;
                    }                    
                }
                form.submit();
            },
            messages: {
                taxes: '{{ "Set taxes or amount duty free"|trans|e('js') }}',
                amountDf: '{{ "Set taxes or amount duty free"|trans|e('js') }}'
            }
        }); 
    });
</script>